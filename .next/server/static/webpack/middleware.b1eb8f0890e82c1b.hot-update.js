"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./middleware.ts":
/*!***********************!*\
  !*** ./middleware.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   middleware: () => (/* binding */ middleware)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n/* provided dependency */ var Buffer = __webpack_require__(/*! buffer */ \"buffer\")[\"Buffer\"];\n\nfunction middleware(request) {\n    const { pathname } = request.nextUrl;\n    const isLoginPage = pathname === \"/admin/login\" || pathname === \"/admin/login/\";\n    // Protect admin routes and admin API routes\n    if ((pathname.startsWith(\"/admin\") || pathname.startsWith(\"/api/admin\")) && !isLoginPage) {\n        const session = request.cookies.get(\"admin-session\");\n        try {\n            if (!session) throw new Error(\"No session\");\n            // Robust decoding for URL-encoded cookies\n            const decodedValue = decodeURIComponent(session.value);\n            const decoded = JSON.parse(Buffer.from(decodedValue, \"base64\").toString(\"utf-8\"));\n            if (!decoded.authenticated) {\n                throw new Error(\"Not authenticated\");\n            }\n        } catch (error) {\n            // For API requests, return a 401 instead of redirecting\n            if (pathname.startsWith(\"/api/\")) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Unauthorized\"\n                }, {\n                    status: 401\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/admin/login/\", request.url));\n        }\n    }\n    // Redirect to dashboard if already logged in\n    if (isLoginPage) {\n        const session = request.cookies.get(\"admin-session\");\n        if (session) {\n            try {\n                const decodedValue = decodeURIComponent(session.value);\n                const decoded = JSON.parse(Buffer.from(decodedValue, \"base64\").toString(\"utf-8\"));\n                if (decoded.authenticated) {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/admin/\", request.url));\n                }\n            } catch (e) {\n            // Ignore decoding errors on login page\n            }\n        }\n    }\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n}\nconst config = {\n    matcher: [\n        \"/admin/:path*\",\n        \"/api/admin/:path*\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vbWlkZGxld2FyZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTJDO0FBR3BDLFNBQVNDLFdBQVdDLE9BQW9CO0lBQzNDLE1BQU0sRUFBRUMsUUFBUSxFQUFFLEdBQUdELFFBQVFFLE9BQU87SUFFcEMsTUFBTUMsY0FBY0YsYUFBYSxrQkFBa0JBLGFBQWE7SUFFaEUsNENBQTRDO0lBQzVDLElBQUksQ0FBQ0EsU0FBU0csVUFBVSxDQUFDLGFBQWFILFNBQVNHLFVBQVUsQ0FBQyxhQUFZLEtBQU0sQ0FBQ0QsYUFBYTtRQUN0RixNQUFNRSxVQUFVTCxRQUFRTSxPQUFPLENBQUNDLEdBQUcsQ0FBQztRQUVwQyxJQUFJO1lBQ0EsSUFBSSxDQUFDRixTQUFTLE1BQU0sSUFBSUcsTUFBTTtZQUU5QiwwQ0FBMEM7WUFDMUMsTUFBTUMsZUFBZUMsbUJBQW1CTCxRQUFRTSxLQUFLO1lBQ3JELE1BQU1DLFVBQVVDLEtBQUtDLEtBQUssQ0FBQ0MsTUFBTUEsQ0FBQ0MsSUFBSSxDQUFDUCxjQUFjLFVBQVVRLFFBQVEsQ0FBQztZQUV4RSxJQUFJLENBQUNMLFFBQVFNLGFBQWEsRUFBRTtnQkFDeEIsTUFBTSxJQUFJVixNQUFNO1lBQ3BCO1FBQ0osRUFBRSxPQUFPVyxPQUFPO1lBQ1osd0RBQXdEO1lBQ3hELElBQUlsQixTQUFTRyxVQUFVLENBQUMsVUFBVTtnQkFDOUIsT0FBT04scURBQVlBLENBQUNzQixJQUFJLENBQUM7b0JBQUVELE9BQU87Z0JBQWUsR0FBRztvQkFBRUUsUUFBUTtnQkFBSTtZQUN0RTtZQUNBLE9BQU92QixxREFBWUEsQ0FBQ3dCLFFBQVEsQ0FBQyxJQUFJQyxJQUFJLGlCQUFpQnZCLFFBQVF3QixHQUFHO1FBQ3JFO0lBQ0o7SUFFQSw2Q0FBNkM7SUFDN0MsSUFBSXJCLGFBQWE7UUFDYixNQUFNRSxVQUFVTCxRQUFRTSxPQUFPLENBQUNDLEdBQUcsQ0FBQztRQUVwQyxJQUFJRixTQUFTO1lBQ1QsSUFBSTtnQkFDQSxNQUFNSSxlQUFlQyxtQkFBbUJMLFFBQVFNLEtBQUs7Z0JBQ3JELE1BQU1DLFVBQVVDLEtBQUtDLEtBQUssQ0FBQ0MsTUFBTUEsQ0FBQ0MsSUFBSSxDQUFDUCxjQUFjLFVBQVVRLFFBQVEsQ0FBQztnQkFDeEUsSUFBSUwsUUFBUU0sYUFBYSxFQUFFO29CQUN2QixPQUFPcEIscURBQVlBLENBQUN3QixRQUFRLENBQUMsSUFBSUMsSUFBSSxXQUFXdkIsUUFBUXdCLEdBQUc7Z0JBQy9EO1lBQ0osRUFBRSxPQUFPQyxHQUFHO1lBQ1IsdUNBQXVDO1lBQzNDO1FBQ0o7SUFDSjtJQUVBLE9BQU8zQixxREFBWUEsQ0FBQzRCLElBQUk7QUFDNUI7QUFFTyxNQUFNQyxTQUFTO0lBQ2xCQyxTQUFTO1FBQUM7UUFBaUI7S0FBb0I7QUFDbkQsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9taWRkbGV3YXJlLnRzPzQyMmQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XHJcbmltcG9ydCB0eXBlIHsgTmV4dFJlcXVlc3QgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtaWRkbGV3YXJlKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgICBjb25zdCB7IHBhdGhuYW1lIH0gPSByZXF1ZXN0Lm5leHRVcmw7XHJcblxyXG4gICAgY29uc3QgaXNMb2dpblBhZ2UgPSBwYXRobmFtZSA9PT0gXCIvYWRtaW4vbG9naW5cIiB8fCBwYXRobmFtZSA9PT0gXCIvYWRtaW4vbG9naW4vXCI7XHJcblxyXG4gICAgLy8gUHJvdGVjdCBhZG1pbiByb3V0ZXMgYW5kIGFkbWluIEFQSSByb3V0ZXNcclxuICAgIGlmICgocGF0aG5hbWUuc3RhcnRzV2l0aChcIi9hZG1pblwiKSB8fCBwYXRobmFtZS5zdGFydHNXaXRoKFwiL2FwaS9hZG1pblwiKSkgJiYgIWlzTG9naW5QYWdlKSB7XHJcbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IHJlcXVlc3QuY29va2llcy5nZXQoXCJhZG1pbi1zZXNzaW9uXCIpO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAoIXNlc3Npb24pIHRocm93IG5ldyBFcnJvcihcIk5vIHNlc3Npb25cIik7XHJcblxyXG4gICAgICAgICAgICAvLyBSb2J1c3QgZGVjb2RpbmcgZm9yIFVSTC1lbmNvZGVkIGNvb2tpZXNcclxuICAgICAgICAgICAgY29uc3QgZGVjb2RlZFZhbHVlID0gZGVjb2RlVVJJQ29tcG9uZW50KHNlc3Npb24udmFsdWUpO1xyXG4gICAgICAgICAgICBjb25zdCBkZWNvZGVkID0gSlNPTi5wYXJzZShCdWZmZXIuZnJvbShkZWNvZGVkVmFsdWUsIFwiYmFzZTY0XCIpLnRvU3RyaW5nKFwidXRmLThcIikpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFkZWNvZGVkLmF1dGhlbnRpY2F0ZWQpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBhdXRoZW50aWNhdGVkXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgLy8gRm9yIEFQSSByZXF1ZXN0cywgcmV0dXJuIGEgNDAxIGluc3RlYWQgb2YgcmVkaXJlY3RpbmdcclxuICAgICAgICAgICAgaWYgKHBhdGhuYW1lLnN0YXJ0c1dpdGgoXCIvYXBpL1wiKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfSwgeyBzdGF0dXM6IDQwMSB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoXCIvYWRtaW4vbG9naW4vXCIsIHJlcXVlc3QudXJsKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFJlZGlyZWN0IHRvIGRhc2hib2FyZCBpZiBhbHJlYWR5IGxvZ2dlZCBpblxyXG4gICAgaWYgKGlzTG9naW5QYWdlKSB7XHJcbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IHJlcXVlc3QuY29va2llcy5nZXQoXCJhZG1pbi1zZXNzaW9uXCIpO1xyXG5cclxuICAgICAgICBpZiAoc2Vzc2lvbikge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGVjb2RlZFZhbHVlID0gZGVjb2RlVVJJQ29tcG9uZW50KHNlc3Npb24udmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGVjb2RlZCA9IEpTT04ucGFyc2UoQnVmZmVyLmZyb20oZGVjb2RlZFZhbHVlLCBcImJhc2U2NFwiKS50b1N0cmluZyhcInV0Zi04XCIpKTtcclxuICAgICAgICAgICAgICAgIGlmIChkZWNvZGVkLmF1dGhlbnRpY2F0ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KG5ldyBVUkwoXCIvYWRtaW4vXCIsIHJlcXVlc3QudXJsKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIElnbm9yZSBkZWNvZGluZyBlcnJvcnMgb24gbG9naW4gcGFnZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UubmV4dCgpO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xyXG4gICAgbWF0Y2hlcjogW1wiL2FkbWluLzpwYXRoKlwiLCBcIi9hcGkvYWRtaW4vOnBhdGgqXCJdLFxyXG59O1xyXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwibWlkZGxld2FyZSIsInJlcXVlc3QiLCJwYXRobmFtZSIsIm5leHRVcmwiLCJpc0xvZ2luUGFnZSIsInN0YXJ0c1dpdGgiLCJzZXNzaW9uIiwiY29va2llcyIsImdldCIsIkVycm9yIiwiZGVjb2RlZFZhbHVlIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwidmFsdWUiLCJkZWNvZGVkIiwiSlNPTiIsInBhcnNlIiwiQnVmZmVyIiwiZnJvbSIsInRvU3RyaW5nIiwiYXV0aGVudGljYXRlZCIsImVycm9yIiwianNvbiIsInN0YXR1cyIsInJlZGlyZWN0IiwiVVJMIiwidXJsIiwiZSIsIm5leHQiLCJjb25maWciLCJtYXRjaGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./middleware.ts\n");

/***/ })

});